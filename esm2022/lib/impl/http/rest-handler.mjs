import { finalize, tap } from 'rxjs/operators';
import { Util } from "../util/util";
export class RestHandler {
    http;
    url;
    observer;
    identifier;
    constructor(http, url, observer, identifier) {
        this.http = http;
        this.url = url;
        this.observer = observer;
        this.identifier = identifier;
    }
    create(model, getParams, httpOptions) {
        this.observer.isCreatingItem = true;
        return this.http.post(Util.armUrlWithSearchParams(this.url, getParams), model, httpOptions)
            .pipe(tap((result) => {
            this.observer.onItemCreated.next(result);
        }), finalize(() => {
            this.observer.isCreatingItem = false;
        }));
    }
    destroy(id, getParams, httpOptions) {
        this.observer.isDestoyingItem = true;
        return this.http.delete(Util.armUrlWithSearchParams(Util.createEntityUrl(this.url, id), getParams), httpOptions).pipe(tap(() => {
            this.observer.onItemDestroyed.next(id);
        }), finalize(() => {
            this.observer.isDestoyingItem = false;
        }));
    }
    partialUpdate(model, getParams, httpOptions) {
        this.observer.isPartiallyUpdatingItem = true;
        return this.http.patch(Util.armUrlWithSearchParams(Util.createEntityUrl(this.url, model[this.identifier]), getParams), model, httpOptions).pipe(tap((result) => {
            this.observer.onItemPartialUpdated.next(result);
        }), finalize(() => {
            this.observer.isPartiallyUpdatingItem = false;
        }));
    }
    save(model, getParams, httpOptions) {
        this.observer.isSavingItem = true;
        let observable;
        if (Util.isDefined(model[this.identifier])) {
            observable = this.update(model, getParams, httpOptions);
        }
        else {
            observable = this.create(model, getParams, httpOptions);
        }
        return observable
            .pipe(tap((result) => {
            this.observer.onItemSaved.next(result);
        }), finalize(() => {
            this.observer.isSavingItem = false;
        }));
    }
    set(model, getParams, httpOptions) {
        this.observer.isSavingItem = true;
        let observable;
        this.observer.isUpdatingItem = true;
        observable = this.http.put(Util.armUrlWithSearchParams(this.url, getParams), model, httpOptions).pipe(tap((result) => {
            this.observer.onItemUpdated.next(result);
        }), finalize(() => {
            this.observer.isUpdatingItem = false;
        }));
        return observable
            .pipe(tap((result) => {
            this.observer.onItemSaved.next(result);
        }), finalize(() => {
            this.observer.isSavingItem = false;
        }));
    }
    update(model, getParams, httpOptions) {
        this.observer.isUpdatingItem = true;
        return this.http.put(Util.armUrlWithSearchParams(Util.createEntityUrl(this.url, model[this.identifier]), getParams), model, httpOptions).pipe(tap((result) => {
            this.observer.onItemUpdated.next(result);
        }), finalize(() => {
            this.observer.isUpdatingItem = false;
        }));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdC1oYW5kbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbXJkLWNvcmUvc3JjL2xpYi9pbXBsL2h0dHAvcmVzdC1oYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBQyxRQUFRLEVBQUUsR0FBRyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFJN0MsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLGNBQWMsQ0FBQztBQUdsQyxNQUFNLE9BQU8sV0FBVztJQUdKO0lBQ0E7SUFDQTtJQUNBO0lBSmxCLFlBQ2tCLElBQWdCLEVBQ2hCLEdBQVcsRUFDWCxRQUFnQyxFQUNoQyxVQUFrQjtRQUhsQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLFFBQUcsR0FBSCxHQUFHLENBQVE7UUFDWCxhQUFRLEdBQVIsUUFBUSxDQUF3QjtRQUNoQyxlQUFVLEdBQVYsVUFBVSxDQUFRO0lBQ2pDLENBQUM7SUFFRyxNQUFNLENBQUMsS0FBUSxFQUFFLFNBQWtCLEVBQUUsV0FBb0I7UUFDOUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1FBQ3BDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQ2pCLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFNBQVMsQ0FBQyxFQUFFLEtBQUssRUFBRSxXQUFXLENBQUM7YUFDdEUsSUFBSSxDQUNILEdBQUcsQ0FBQyxDQUFDLE1BQVMsRUFBRSxFQUFFO1lBQ2hCLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMzQyxDQUFDLENBQUMsRUFDRixRQUFRLENBQUMsR0FBRyxFQUFFO1lBQ1osSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUNILENBQUM7SUFDTixDQUFDO0lB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QUksQ0FBQyxRQUFRLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztDQUdGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHtmaW5hbGl6ZSwgdGFwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7SHR0cENsaWVudH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQge0lXcml0ZWFibGVSZXN0U2VydmljZX0gZnJvbSBcIi4uLy4uL2ludGVyZmFjZS9odHRwL2ktd3JpdGVhYmxlLXJlc3Qtc2VydmljZVwiO1xyXG5pbXBvcnQge1Jlc3RTZXJ2aWNlT2JzZXJ2ZXJ9IGZyb20gXCIuL3Jlc3Qtc2VydmljZS1vYnNlcnZlclwiO1xyXG5pbXBvcnQge1V0aWx9IGZyb20gXCIuLi91dGlsL3V0aWxcIjtcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgUmVzdEhhbmRsZXI8VD4gaW1wbGVtZW50cyBJV3JpdGVhYmxlUmVzdFNlcnZpY2U8VD4ge1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyByZWFkb25seSBodHRwOiBIdHRwQ2xpZW50LFxyXG4gICAgcHVibGljIHJlYWRvbmx5IHVybDogc3RyaW5nLFxyXG4gICAgcHVibGljIHJlYWRvbmx5IG9ic2VydmVyOiBSZXN0U2VydmljZU9ic2VydmVyPFQ+LFxyXG4gICAgcHVibGljIHJlYWRvbmx5IGlkZW50aWZpZXI6IHN0cmluZ1xyXG4gICkge31cclxuXHJcbiAgcHVibGljIGNyZWF0ZShtb2RlbDogVCwgZ2V0UGFyYW1zPzogb2JqZWN0LCBodHRwT3B0aW9ucz86IG9iamVjdCk6IE9ic2VydmFibGU8VD4ge1xyXG4gICAgdGhpcy5vYnNlcnZlci5pc0NyZWF0aW5nSXRlbSA9IHRydWU7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8VD4oXHJcbiAgICAgICAgVXRpbC5hcm1VcmxXaXRoU2VhcmNoUGFyYW1zKHRoaXMudXJsLCBnZXRQYXJhbXMpLCBtb2RlbCwgaHR0cE9wdGlvbnMpXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIHRhcCgocmVzdWx0OiBUKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLm9ic2VydmVyLm9uSXRlbUNyZWF0ZWQubmV4dChyZXN1bHQpO1xyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMub2JzZXJ2ZXIuaXNDcmVhdGluZ0l0ZW0gPSBmYWxzZTtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGRlc3Ryb3koaWQ6IGFueSwgZ2V0UGFyYW1zPzogb2JqZWN0LCBodHRwT3B0aW9ucz86IG9iamVjdCk6IE9ic2VydmFibGU8dm9pZD4ge1xyXG4gICAgdGhpcy5vYnNlcnZlci5pc0Rlc3RveWluZ0l0ZW0gPSB0cnVlO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5kZWxldGU8dm9pZD4oXHJcbiAgICAgIFV0aWwuYXJtVXJsV2l0aFNlYXJjaFBhcmFtcyhcclxuICAgICAgICBVdGlsLmNyZWF0ZUVudGl0eVVybCh0aGlzLnVybCwgaWQpLCBnZXRQYXJhbXNcclxuICAgICAgKSxcclxuICAgICAgaHR0cE9wdGlvbnNcclxuICAgICkucGlwZShcclxuICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyLm9uSXRlbURlc3Ryb3llZC5uZXh0KGlkKTtcclxuICAgICAgfSksXHJcbiAgICAgIGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyLmlzRGVzdG95aW5nSXRlbSA9IGZhbHNlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwYXJ0aWFsVXBkYXRlKG1vZGVsOiBULCBnZXRQYXJhbXM/OiBvYmplY3QsIGh0dHBPcHRpb25zPzogb2JqZWN0KTogT2JzZXJ2YWJsZTxUPiB7XHJcbiAgICB0aGlzLm9ic2VydmVyLmlzUGFydGlhbGx5VXBkYXRpbmdJdGVtID0gdHJ1ZTtcclxuICAgIHJldHVybiB0aGlzLmh0dHAucGF0Y2g8VD4oXHJcbiAgICAgIFV0aWwuYXJtVXJsV2l0aFNlYXJjaFBhcmFtcyhcclxuICAgICAgICBVdGlsLmNyZWF0ZUVudGl0eVVybCh0aGlzLnVybCwgbW9kZWxbdGhpcy5pZGVudGlmaWVyXSksIGdldFBhcmFtc1xyXG4gICAgICApLFxyXG4gICAgICBtb2RlbCxcclxuICAgICAgaHR0cE9wdGlvbnNcclxuICAgICkucGlwZShcclxuICAgICAgdGFwKChyZXN1bHQ6IFQpID0+IHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyLm9uSXRlbVBhcnRpYWxVcGRhdGVkLm5leHQocmVzdWx0KTtcclxuICAgICAgfSksXHJcbiAgICAgIGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyLmlzUGFydGlhbGx5VXBkYXRpbmdJdGVtID0gZmFsc2U7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNhdmUobW9kZWw6IFQsIGdldFBhcmFtcz86IG9iamVjdCwgaHR0cE9wdGlvbnM/OiBvYmplY3QpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIHRoaXMub2JzZXJ2ZXIuaXNTYXZpbmdJdGVtID0gdHJ1ZTtcclxuICAgIGxldCBvYnNlcnZhYmxlOiBPYnNlcnZhYmxlPFQ+O1xyXG4gICAgaWYgKFV0aWwuaXNEZWZpbmVkKG1vZGVsW3RoaXMuaWRlbnRpZmllcl0pKSB7XHJcbiAgICAgIG9ic2VydmFibGUgPSB0aGlzLnVwZGF0ZShtb2RlbCwgZ2V0UGFyYW1zLCBodHRwT3B0aW9ucyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBvYnNlcnZhYmxlID0gdGhpcy5jcmVhdGUobW9kZWwsIGdldFBhcmFtcywgaHR0cE9wdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9ic2VydmFibGVcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgdGFwKChyZXN1bHQ6IFQpID0+IHtcclxuICAgICAgICAgIHRoaXMub2JzZXJ2ZXIub25JdGVtU2F2ZWQubmV4dChyZXN1bHQpO1xyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMub2JzZXJ2ZXIuaXNTYXZpbmdJdGVtID0gZmFsc2U7XHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQobW9kZWw6IFQsIGdldFBhcmFtcz86IG9iamVjdCwgaHR0cE9wdGlvbnM/OiBvYmplY3QpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIHRoaXMub2JzZXJ2ZXIuaXNTYXZpbmdJdGVtID0gdHJ1ZTtcclxuICAgIGxldCBvYnNlcnZhYmxlOiBPYnNlcnZhYmxlPFQ+O1xyXG4gICAgdGhpcy5vYnNlcnZlci5pc1VwZGF0aW5nSXRlbSA9IHRydWU7XHJcbiAgICBvYnNlcnZhYmxlID0gdGhpcy5odHRwLnB1dDxUPihcclxuICAgICAgVXRpbC5hcm1VcmxXaXRoU2VhcmNoUGFyYW1zKFxyXG4gICAgICAgIHRoaXMudXJsLCBnZXRQYXJhbXNcclxuICAgICAgKSxcclxuICAgICAgbW9kZWwsXHJcbiAgICAgIGh0dHBPcHRpb25zXHJcbiAgICApLnBpcGUoXHJcbiAgICAgIHRhcCgocmVzdWx0OiBUKSA9PiB7XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlci5vbkl0ZW1VcGRhdGVkLm5leHQocmVzdWx0KTtcclxuICAgICAgfSksXHJcbiAgICAgIGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyLmlzVXBkYXRpbmdJdGVtID0gZmFsc2U7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiBvYnNlcnZhYmxlXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIHRhcCgocmVzdWx0OiBUKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLm9ic2VydmVyLm9uSXRlbVNhdmVkLm5leHQocmVzdWx0KTtcclxuICAgICAgICB9KSxcclxuICAgICAgICBmaW5hbGl6ZSgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLm9ic2VydmVyLmlzU2F2aW5nSXRlbSA9IGZhbHNlO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdXBkYXRlKG1vZGVsOiBULCBnZXRQYXJhbXM/OiBvYmplY3QsIGh0dHBPcHRpb25zPzogb2JqZWN0KTogT2JzZXJ2YWJsZTxUPiB7XHJcbiAgICB0aGlzLm9ic2VydmVyLmlzVXBkYXRpbmdJdGVtID0gdHJ1ZTtcclxuICAgIHJldHVybiB0aGlzLmh0dHAucHV0PFQ+KFxyXG4gICAgICBVdGlsLmFybVVybFdpdGhTZWFyY2hQYXJhbXMoXHJcbiAgICAgICAgVXRpbC5jcmVhdGVFbnRpdHlVcmwodGhpcy51cmwsIG1vZGVsW3RoaXMuaWRlbnRpZmllcl0pLCBnZXRQYXJhbXNcclxuICAgICAgKSxcclxuICAgICAgbW9kZWwsXHJcbiAgICAgIGh0dHBPcHRpb25zXHJcbiAgICApLnBpcGUoXHJcbiAgICAgIHRhcCgocmVzdWx0OiBUKSA9PiB7XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlci5vbkl0ZW1VcGRhdGVkLm5leHQocmVzdWx0KTtcclxuICAgICAgfSksXHJcbiAgICAgIGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyLmlzVXBkYXRpbmdJdGVtID0gZmFsc2U7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcblxyXG59XHJcbiJdfQ==